---
// src/components/YandexMetrika.astro
// Определяем язык из URL
const isEnglish = Astro.url.pathname.includes('/en/');
const currentLang = isEnglish ? 'en' : 'ru';

// Ваш существующий ID счетчика
const METRIKA_ID = '103737764';
---

<!-- Yandex.Metrika counter -->
<script type="text/javascript">
    (function(m,e,t,r,i,k,a){
        m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
        m[i].l=1*new Date();
        for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
        k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)
    })(window, document,'script','https://mc.yandex.ru/metrika/tag.js?id=103737764', 'ym');
    
    ym(103737764, 'init', {
        ssr: true, 
        webvisor: true, 
        clickmap: true, 
        ecommerce: "dataLayer", 
        accurateTrackBounce: true, 
        trackLinks: true,
        // Добавляем параметр языка
        params: {
            language: currentLang
        }
    });
    
    // Отмечаем язык страницы
    ym(103737764, 'userParams', {
        language: currentLang
    });
</script>
<noscript>
    <div>
        <img src="https://mc.yandex.ru/watch/103737764" style="position:absolute; left:-9999px;" alt="" />
    </div>
</noscript>
<!-- /Yandex.Metrika counter -->

<!-- Минимальное отслеживание событий -->
<script define:vars={{ currentLang }}>
document.addEventListener('DOMContentLoaded', function() {
    // Переключение языка
    const langSwitchers = document.querySelectorAll('a[href*="/en/"], a[href*="/ru/"]');
    langSwitchers.forEach(link => {
        link.addEventListener('click', function() {
            const targetLang = this.href.includes('/en/') ? 'en' : 'ru';
            if (typeof ym !== 'undefined') {
                ym(103737764, 'reachGoal', `lang_switch_${currentLang}_to_${targetLang}`);
            }
        });
    });

    // Telegram контакты
    const telegramLinks = document.querySelectorAll('a[href*="t.me"], a[href*="telegram"]');
    telegramLinks.forEach(link => {
        link.addEventListener('click', function() {
            if (typeof ym !== 'undefined') {
                ym(103737764, 'reachGoal', `telegram_${currentLang}`);
            }
        });
    });
});
</script>